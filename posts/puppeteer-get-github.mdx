---
title: 'Puppeteerçˆ¬å–GithubæŒ‡åŒ—'
date: 2021/07/07
tags:
  - å‰ç«¯
  - node.js
slug: puppeteer-get-github
description: ä½¿ç”¨puppeteerçˆ¬å–Githubä¸­çš„æ•°æ®
---

# ä»‹ç»

> puppeteer æ˜¯ä¸€ä¸ªChromeå®˜æ–¹å‡ºå“çš„headless Chrome nodeåº“ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—çš„API, å¯ä»¥åœ¨æ— UIçš„æƒ…å†µä¸‹è°ƒç”¨Chromeçš„åŠŸèƒ½, é€‚ç”¨äºçˆ¬è™«ã€è‡ªåŠ¨åŒ–å¤„ç†ç­‰å„ç§åœºæ™¯ã€‚

# ä½¿ç”¨

## å®‰è£…

> npm install puppeteer-chromium-resolver --save

## ç”Ÿæˆ/å…³é—­æµè§ˆå™¨

```js
const browser = await puppeteer.launch({
  args: ['--no-sandbox', '--disable-setuid-sandbox'],
  //å¦‚æœæ˜¯è®¿é—®httpsé¡µé¢ æ­¤å±æ€§ä¼šå¿½ç•¥httpsé”™è¯¯
  ignoreHTTPSErrors: true,
  headless: true, //æ”¹ä¸ºtrueåˆ™æ˜¯æ— å¤´æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºæµè§ˆå™¨ï¼Œåœ¨æ— ç•Œé¢çš„ç¯å¢ƒä¸­è¿è¡Œ Chrome
});

//å…³é—­
browser.close();
```

## ç”Ÿæˆæ–°çš„tabå¹¶ä¸”è·³è½¬

```js
const page = await browser.newPage();
await page.goto('https://github.com/' + name + '?tab=repositories'); //è·³è½¬åˆ°githubæŸä¸ªç”¨æˆ·çš„ä»“åº“é¡µ
```

## åœ¨æ§åˆ¶å°ä¸­æ‰§è¡Œå‡½æ•°ï¼ˆ evaluate() ï¼‰

```js
//è·å–å½“é¡µçš„æ‰€æœ‰é¡¹ç›®urlï¼ŒåŒæ—¶æœ‰ä¸‹ä¸€é¡µä»“åº“çš„urlçš„è¯ä¹Ÿè·å–
const rep = await page.evaluate(() => {
  const url = document.querySelectorAll('.wb-break-all > a');
  const next = document.querySelector('.BtnGroup > a');
  let urlList = undefined;
  let nextUrl = undefined;
  if (url != null) {
    urlList = Array.prototype.map.call(url, (item) => {
      return item.href;
    });
  }
  if (next != null && next.outerText === 'Next') {
    nextUrl = next.href;
  }
  return {
    urlList: urlList,
    nextUrl: nextUrl,
  };
});
```

## è·å–é¡µé¢å…ƒç´ 

```js
const el = await page.$(selector);
```

## ç‚¹å‡»å…ƒç´ 

```js
await el.click();
```

## è¾“å…¥å†…å®¹

```js
await el.type(text);
```

# çˆ¬å–Githubä¸­çš„æ•°æ®

ä½¿ç”¨äº†expressï¼Œå› ä¸ªäººéœ€è¦çˆ¬å–äº†æŒ‡å®šç”¨æˆ·çš„followeræ•°ï¼Œä»¥åŠcommitè¿‡çš„æ—¥æœŸä»¥åŠå½“å¤©commitçš„æ¬¡æ•°ï¼Œè¿˜æœ‰çˆ¬å–æ¯ä¸€ä¸ªå…¬å¼€çš„é¡¹ç›®çš„urlã€é¡¹ç›®åã€commitæ•°ä»¥åŠstaræ•°ï¼Œæ‹¼æ¥åè¿”å›jsonã€‚

é¡¹ç›®åœ°å€ï¼š[getGithub](https://github.com/Magren0321/getGithub)

è°ƒç”¨ä¾‹å­ï¼š

> http://localhost:4000/getAllContributions/Magren0321

è¿”å›æ•°æ®ç¤ºä¾‹ï¼š
![](/postImg/puppeteer-get-github/test.png)

# è¸©åˆ°çš„å‘

åœ¨çˆ¬å–æ¯ä¸€å¹´çš„contributionsæ•°çš„æ—¶å€™ï¼Œè·å–å…¶å…ƒç´ çš„å±æ€§å¤±è´¥ï¼Œå› ä¸ºå…¶**data-date**ä»¥åŠ**data-count**ç­‰å±æ€§æ˜¯githubè‡ªå·±å®šä¹‰çš„å±æ€§ï¼Œæ— æ³•ç›´æ¥è·å–ï¼Œè¿™é‡Œå¿…é¡»å¾—ä½¿ç”¨**getAttribute**()æ–¹æ³•ã€‚

åŒæ—¶Attributeä¸­è¿˜æœ‰setAttribute()å’ŒremoveAttribute()ï¼Œåˆ†åˆ«æ˜¯è®¾ç½®å’Œç§»é™¤èŠ‚ç‚¹åŸå‹ä¸­ä¸å­˜åœ¨çš„å±æ€§ã€‚

```js
//è·å–æ—¥æœŸä»¥åŠå½“å¤©çš„æäº¤æ•°
async function getDateList(yearData, page) {
  await page.goto(yearData);
  const dateList = await page.evaluate(() => {
    const date = document.querySelectorAll('.ContributionCalendar-day');
    const datelist = [];
    for (let item of date) {
      if (
        item.getAttribute('data-count') != 0 &&
        item.getAttribute('data-count') != null
      ) {
        datelist.push({
          data_date: item.getAttribute('data-date'),
          data_count: item.getAttribute('data-count'),
        });
      }
    }

    return datelist;
  });
  return dateList;
}
```

Github apiè¿˜æœ‰ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„åœ°æ–¹å°±ä¸æ€»ç»“äº†â€¦â€¦  
æ¯”å¦‚è¿”å›ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œä½†æ˜¯æˆ‘è¾“å‡ºå…¶lengthå±…ç„¶æ˜¯2ï¼Œç”¨ç›´æ¥è¯·æ±‚å‘ç°æ˜¯é‡Œé¢æ”¾äº†ä¸¤ä¸ªæ¢è¡ŒğŸ˜µ  
åªèƒ½æ‰¾å¤šå‡ ä¸ªæ•°æ®æµ‹è¯•ğŸ˜”
