---
title: Vue Typescriptä¸‹axiosçš„å°è£…å’Œä½¿ç”¨
description: Typescriptä¸‹axiosçš„å°è£…å’Œä½¿ç”¨ï¼Œè®°å½•ä¸‹æ¥ï¼ˆå…¶å®å°±æ˜¯æ–¹ä¾¿è‡ªå·±åç»­copyï¼‰
tags:
  - å‰ç«¯
  - Vue
  - Typescript
publish: true
slug: vue-ts-axios
date: 2020/08/12
---

8æœˆåˆ°äº†ï¼Œä¸€ä¸ªè«åå…¶å¦™çš„æœºé‡ä¹Ÿç ¸åˆ°äº†è„¸ä¸Šï¼Œæç€è¡Œæä¸€ä¸ªäººè·‘åˆ°äº†å¹¿å·è·Ÿä¸€ä¸ªæ¯•ä¸šçš„å¸ˆå…„æåˆ›ä¸šçš„é¡¹ç›®ï¼Œæ€€ç€ç‚¹ç‚¹çš„ä¸å®‰ä»¥åŠå…´å¥‹ï¼Œè¿ˆå‡ºç¦»å¼€å­¦æ ¡çš„ç¬¬ä¸€æ­¥ã€‚

ç”±äºå°±ä½åœ¨åŠå…¬å®¤çš„ä¸€é—´æˆ¿é‡Œï¼Œå‡ºé—¨å³å·¥ä½œï¼Œå¼€å§‹äº†æœäº”æ™šä¹çš„å·¥ä½œç”Ÿæ´»ï¼Œæ™šä¸Šçš„æ—¶å€™å°±æŠ˜è…¾è‡ªå·±çš„é¡¹ç›®ï¼Œæœ‰ç‚¹æ¢¦å›æ˜Ÿç©ºæ—¶å€™å¤è®­è¥çš„æ„Ÿè§‰ï¼Œå¾ˆç´¯ä¹Ÿå……å®ã€‚æ¯å¤©ä¹Ÿåœ¨æ‰å¤´å‘ä»¥åŠçƒ¦æ¼åƒä»€ä¹ˆ

è‡ªå·±å†™çš„åå¹¿åœ°å›¾ç»™è‡ªå®¶eoå‘äº†ä¸€ä»½ç©ï¼Œç»“æœç»™å¾æ”¶äº†ï¼Œä¸Šçº¿æˆäº†æ˜Ÿç©ºçš„äº§å“ï¼Œå¹¶ä¸”è¦æ±‚å†è¿›è¡Œå®Œå–„ ğŸ˜Ÿ
æƒ³äº†ä¸‹å¹²è„†ç»™æ¯ä¸ªåœ°ç‚¹çš„markeræ·»åŠ ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»åå¯ä»¥çœ‹åˆ°è¯¥åœ°ç‚¹çš„è¯¦ç»†ä»‹ç»ï¼Œä¸è¿‡æ¯ä¸ªåœ°æ–¹éƒ½è¦å›¾ç‰‡ï¼Œæ”¾åœ¨æœ¬åœ°å¤ªå¤§äº†ï¼Œå¯èƒ½ä¼šé€ æˆå¡é¡¿ï¼Œé‚å†³å®šæ”¾åœ¨æœåŠ¡å™¨ä¸Šï¼Œäºæ˜¯é‡æ–°çœ‹äº†ä¸€éaxiosåŒæ—¶è‡ªå·±å­¦ç€ç½‘ä¸Šçš„ä¸€äº›æ•™ç¨‹åšäº†ä¸€ä¸ªå°è£…ï¼Œå¹¶è§£å†³äº†è·¨åŸŸçš„é—®é¢˜ã€‚


# å°è£…axios

```js
import axios, { AxiosRequestConfig, AxiosResponse } from 'axios'

const showStatus = (status: number) => {
  let message = ''
  switch (status) {
    case 400:
      message = 'è¯·æ±‚é”™è¯¯(400)'
      break
    case 401:
      message = 'æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•(401)'
      break
    case 403:
      message = 'æ‹’ç»è®¿é—®(403)'
      break
    case 404:
      message = 'è¯·æ±‚å‡ºé”™(404)'
      break
    case 408:
      message = 'è¯·æ±‚è¶…æ—¶(408)'
      break
    case 500:
      message = 'æœåŠ¡å™¨é”™è¯¯(500)'
      break
    case 501:
      message = 'æœåŠ¡æœªå®ç°(501)'
      break
    case 502:
      message = 'ç½‘ç»œé”™è¯¯(502)'
      break
    case 503:
      message = 'æœåŠ¡ä¸å¯ç”¨(503)'
      break
    case 504:
      message = 'ç½‘ç»œè¶…æ—¶(504)'
      break
    case 505:
      message = 'HTTPç‰ˆæœ¬ä¸å—æ”¯æŒ(505)'
      break
    default:
      message = `è¿æ¥å‡ºé”™(${status})!`
  }
  return `${message}`
}

const service = axios.create({
  // è”è°ƒ
  baseURL: 'https://www.wanandroid.com',
  headers: {
    get: {
      'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'
    },
    post: {
      'Content-Type': 'application/json;charset=utf-8'
    }
  },
  // æ˜¯å¦è·¨ç«™ç‚¹è®¿é—®æ§åˆ¶è¯·æ±‚
  withCredentials: true,
  timeout: 30000, //è¶…æ—¶æ—¶é—´
  transformRequest: [(data) => {
    data = JSON.stringify(data)
    return data
  }],
  validateStatus () {
    // ä½¿ç”¨async-awaitï¼Œå¤„ç†rejectæƒ…å†µè¾ƒä¸ºç¹çï¼Œæ‰€ä»¥å…¨éƒ¨è¿”å›resolveï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¸­å¤„ç†å¼‚å¸¸
    return true
  },
  transformResponse: [(data) => {
    if (typeof data === 'string' && data.startsWith('{')) {
      data = JSON.parse(data)
    }
    return data
  }]
})

// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use((config: AxiosRequestConfig) => {
    return config
}, (error) => {
    // é”™è¯¯æŠ›åˆ°ä¸šåŠ¡ä»£ç 
    error.data = {}
    error.data.msg = 'æœåŠ¡å™¨å¼‚å¸¸'
    return Promise.resolve(error)
})

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use((response: AxiosResponse) => {
    const status = response.status
    let msg = ''
    if (status < 200 || status >= 300) {
        // å¤„ç†httpé”™è¯¯ï¼ŒæŠ›åˆ°ä¸šåŠ¡ä»£ç 
        msg = showStatus(status)
        if (typeof response.data === 'string') {
            response.data = {msg}
        } else {
            response.data.msg = msg
        }
    }
    return response
}, (error) => {
    // é”™è¯¯æŠ›åˆ°ä¸šåŠ¡ä»£ç 
    error.data = {}
    error.data.msg = 'è¯·æ±‚è¶…æ—¶æˆ–æœåŠ¡å™¨å¼‚å¸¸'
    return Promise.resolve(error)
})

export default service
```

# ä½¿ç”¨

```js
@Component
export default class Home extends Vue{
  a = []
  getSomeThings(){
    return request({
        url: "/wxarticle/list/408/1/json",
        method:'get'
    }).then((response)=>{
      this.a = response.data.data.datas
      console.log(this.a)
    }).catch((error)=>{
      console.log(error)
    })
  }

 mounted(){
   this.getSomeThings()
 }
```

# è§£å†³è·¨åŸŸé—®é¢˜

å…³äºä»€ä¹ˆæ˜¯è·¨åŸŸä¹‹å‰åœ¨ajaxä¸Šå·²ç»äº†è§£è¿‡äº†ï¼Œæ˜¯ç”±æµè§ˆå™¨çš„åŒæºç­–ç•¥é€ æˆçš„ï¼Œæ˜¯æµè§ˆå™¨å¯¹jsæ–½åŠ çš„å®‰å…¨æªæ–½ã€‚

## axiosè§£å†³è·¨åŸŸçš„æ€è·¯

> æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ä¸ªä»£ç†çš„æœåŠ¡å™¨å¯ä»¥è¯·æ±‚å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸­çš„æ•°æ®ï¼Œç„¶åæŠŠè¯·æ±‚å‡ºæ¥çš„æ•°æ®è¿”å›åˆ°æˆ‘ä»¬çš„ä»£ç†æœåŠ¡å™¨ä¸­ï¼Œä»£ç†æœåŠ¡å™¨å†è¿”å›æ•°æ®ç»™æˆ‘ä»¬çš„å®¢æˆ·ç«¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°è·¨åŸŸè®¿é—®æ•°æ®ã€‚

### é…ç½®proxy

åœ¨æˆ‘ä»¬çš„vue.config.jsä¸‹é…ç½®ä»¥ä¸‹å†…å®¹

```js
module.exports = {
    devServer: {
        proxy: {
            '/api': {
                target: 'https://www.wanandroid.com',// ä½ è¦è¯·æ±‚çš„åç«¯æ¥å£ip+port
                changeOrigin: true,// å…è®¸è·¨åŸŸï¼Œåœ¨æœ¬åœ°ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹ŸæœåŠ¡ç«¯ï¼Œç„¶åå‘é€è¯·æ±‚çš„æ•°æ®ï¼Œå¹¶åŒæ—¶æ¥æ”¶è¯·æ±‚çš„æ•°æ®ï¼Œè¿™æ ·æœåŠ¡ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œæ•°æ®çš„äº¤äº’å°±ä¸ä¼šæœ‰è·¨åŸŸé—®é¢˜
                ws: true,// å¼€å¯webSocket
                pathRewrite: {
                    '^/api': '',// æ›¿æ¢æˆtargetä¸­çš„åœ°å€
                }
            }
        }
    }
}
```

### é…ç½®baseURL

åœ¨æˆ‘ä»¬å°è£…çš„axiosæ–‡ä»¶é‡Œå°†baseURLæ›´æ”¹ä¸º:â€™/apiâ€™

```js
const service = axios.create({
  baseURL: '/api',

  â€¦â€¦â€¦â€¦

})
```

æ‰€ä»¥ä¸Šé¢ä¸¤æ­¥æ“ä½œæ˜¯å•¥æ„æ€å‘¢ï¼Œå…¶å®å°±æ˜¯ï¼š

> æˆ‘ä»¬è¯·æ±‚/wxarticle/list/408/1/jsonï¼Œå°±ç›¸å½“äºè¯·æ±‚äº†ï¼šlocalhost:8080/api/wxarticle/list/408/1/jsonï¼Œ
> ç„¶åé…ç½®çš„proxyæ‹¦æˆªäº†/apiï¼Œå¹¶æŠŠ/apiä»¥åŠå‰é¢çš„æ‰€æœ‰æ›¿æ¢æˆäº†targetçš„å†…å®¹ï¼Œ
> å› æ­¤å®é™…è¯·æ±‚çš„urlæ˜¯https://www.wanandroid.com/wxarticle/list/408/1/json
> å³è¯·æ±‚åˆ°äº†æˆ‘ä»¬éœ€è¦çš„æ¥å£äº†

# æœ€å

æ—¢ç„¶ææ˜ç™½çš„å·®ä¸å¤šäº†ï¼Œå°±ä¸Šæ‰‹å§ï¼Œ

> ***å­¦æ ¡çš„å›¾ç‰‡å‘¢ï¼Ÿ***

> ***å•Šï¼Ÿæ²¡æœ‰å•Š***

> ***æ‘„å½±é‚£ä¸€è¾¹å‘¢ï¼Ÿ*** ğŸ˜§

> ***ä»–ä»¬â€¦â€¦ä¹Ÿåªæœ‰ä¸€éƒ¨åˆ†â€¦â€¦*** ğŸ˜§

> ***å•Šâ€¦â€¦è¿™â€¦â€¦*** ğŸ˜©

**ç»¼ä¸Šæ‰€è¿°ï¼Œé¡¹ç›®ç›®å‰ææµ…ä¸­** ğŸ’¢
