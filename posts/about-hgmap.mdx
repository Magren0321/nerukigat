---
title: å…³äºHGåœ°å›¾
tags:
  - å‰ç«¯
  - Vue
  - Typescript
  - é¡¹ç›®
slug: about-hgmap
date: 2020/07/30
publish: true
description: æœ€è¿‘éƒ½åœ¨å­¦ä¹ å‰ç«¯çš„è·¯ä¸Šç¼“æ…¢å‰è¿›ï¼Œåœ¨äº†è§£äº†Vueåå°±å¼€å§‹å­¦ä¹ Typescriptï¼Œæ¯æ¬¡å­¦ä¹ åˆ°æ–°ä¸œè¥¿çš„æ—¶å€™éƒ½ä¼šå¿ä¸ä½ç”¨æ–°çš„ä¸œè¥¿å»åšä¸€ä¸ªè‡ªå·±æ„Ÿå…´è¶£çš„ä¸œè¥¿ï¼Œå¯èƒ½è‡ªå·±è§‰å¾—è¿™æ ·å­å¾ˆCooooooooooooolï¼ğŸ‘Š
---

æœ€è¿‘éƒ½åœ¨å­¦ä¹ å‰ç«¯çš„è·¯ä¸Šç¼“æ…¢å‰è¿›ï¼Œåœ¨äº†è§£äº†Vueåå°±å¼€å§‹å­¦ä¹ Typescriptï¼Œæ¯æ¬¡å­¦ä¹ åˆ°æ–°ä¸œè¥¿çš„æ—¶å€™éƒ½ä¼šå¿ä¸ä½ç”¨æ–°çš„ä¸œè¥¿å»åšä¸€ä¸ªè‡ªå·±æ„Ÿå…´è¶£çš„ä¸œè¥¿ï¼Œå¯èƒ½è‡ªå·±è§‰å¾—è¿™æ ·å­å¾ˆCooooooooooooolï¼ğŸ‘Š


ä¹‹å‰å¶ç„¶é—´ä¹Ÿçœ‹åˆ°äº†å‰ç çš„åœ°å›¾ï¼Œè§‰å¾—å¾ˆä¼˜ç§€ï¼Œç¢°å·§æˆ‘ä»¬å­¦æ ¡æ²¡æœ‰ç›¸å…³çš„äº§å“ï¼Œåªæœ‰ä¸€å¼ ç”»å‡ºæ¥å›¾ç‰‡åœ°å›¾ï¼Œç¨åŠ æ€ç´¢

  - è€ƒè™‘åˆ°äº†ä¾¿æºæ€§ï¼Œå†³å®šæ”¾åœ¨ç§»åŠ¨ç«¯ä½¿ç”¨
  - è¦å¯ä»¥æ ‡ç¤ºå‡ºå­¦æ ¡çš„è®¾æ–½åœ°ç‚¹
  - æ ¡å·´çš„è·¯çº¿ä»¥åŠä¸Šä¸‹è½¦åœ°ç‚¹
  - è¦æœ‰äº§å“çš„ä»‹ç»è¿˜æœ‰å­¦æ ¡çš„ä»‹ç»
  - æœ€å¥½èƒ½å¤Ÿçœ‹åˆ°å­¦æ ¡å®æ™¯

  åŠ ä¸Šè‡ªå·±ä¹‹å‰å­¦äº†vueï¼Œä¾¿æ‰“ç®—ç»“åˆvueæ¥å†™ï¼Œè¯´å¹²å°±å¹²ï¼Œèµ·é£ï¼âœˆï¸

  ç„¶åç¬¬ä¸€å¤©å°±ç¿»è½¦åœ¨äº†åˆ›å»ºé¡¹ç›®ä¸Šã€‚

  ä¸€å¼€å§‹è£…çš„Vueçš„ç‰ˆæœ¬æ˜¯2.xç‰ˆæœ¬ï¼Œåˆ›å»ºæ–°é¡¹ç›®çš„webpackç‰ˆæœ¬æ˜¯3.6çš„ï¼Œä½¿ç”¨Typescriptçš„æ—¶å€™ä¼šæç¤ºéœ€è¦å‡çº§webpackåˆ°4.xç‰ˆæœ¬ï¼Œä¸€å¼€å§‹å¹¶æ²¡æœ‰è€ƒè™‘å¤ªå¤šï¼Œå®ƒæç¤ºå•¥é—®é¢˜å°±Googleå•¥é—®é¢˜æ€ä¹ˆè§£å†³ï¼ˆé¢å‘æœç´¢å¼•æ“ç¼–ç¨‹ï¼‰ï¼Œå¤§è‡´çœ‹äº†ä¸€åœˆï¼Œéƒ½æ˜¯å¸è½½æ—§ç‰ˆçš„ä¾èµ–è£…æ–°çš„ä¾èµ–ï¼ŒåŒæ—¶ä¿®æ”¹é…ç½®ï¼Œä½†æ˜¯ä»–ä»¬çš„æ•™ç¨‹åŸºæœ¬éƒ½ä¸ä¸€æ ·ï¼Œå”¯ä¸€ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯éƒ½å¾ˆå¤æ‚ï¼Œä¹Ÿä¸çŸ¥é“å’‹é€‰ï¼Œå°±æŒ‘äº†ä¸ªé¡ºçœ¼çš„å°±å¼€å§‹ç…§ç€å†™ï¼Œç»“æœå¤±è´¥äº†â€¦â€¦åé¢å‘ç°Vue3.xç‰ˆæœ¬å¼€å§‹éƒ½å·²ç»å¼€å§‹é€‚é…Typescriptäº†ï¼Œå³åˆ›å»ºé¡¹ç›®çš„æ—¶å€™å°±å¯ä»¥é€‰æ‹©æ˜¯å¦ä½¿ç”¨Typescriptï¼ŒåŒæ—¶è‡ªåŠ¨ç»™ä½ é…ç½®å¥½â€¦â€¦å•Šè¿™ã€‚

  æ—§ç‰ˆæœ¬Vueå¸è½½ï¼

  > npm uninstall vue-cli -g

  æœ€æ–°ç‰ˆæœ¬Vueå®‰è£…ï¼

  > npm install -g @vue/cli

  å†æ¥ä¸€éï¼Œèµ·é£ï¼âœˆï¸

  é¡¹ç›®åœ°å€ï¼š[HgMap](https://github.com/Magren0321/hgmap)
  åœ°å›¾é“¾æ¥ï¼š[åå¹¿åœ°å›¾](https://map.xingkong.us/)

  # ç¯å¢ƒä¾èµ–

  - vue/cli 4.4.6
  - typescript
  - element-uiï¼šuiç»„ä»¶
  - vue-class-componentï¼šç±»è£…é¥°å™¨
  - vue-property-decoratorï¼šåŸºäº vue ç»„ç»‡é‡Œ vue-class-component æ‰€åšçš„æ‹“å±•
  - vue2-svg-iconï¼šSVGå›¾æ ‡ç»„ä»¶
  - åœ°å›¾èµ„æºæ¥è‡ªé«˜å¾·åœ°å›¾api

  æ³¨ï¼šç”±äºvue-cli 4ç‰ˆæœ¬ä¸è‡ªå¸¦vue.config.jsï¼Œæ•…éœ€è‡ªè¡Œåœ¨æ ¹ç›®å½•åˆ›å»ºå¹¶ä¸”é…ç½®ï¼Œå¦åˆ™æ‰“åŒ…é¡¹ç›®ä¼šæ‰¾ä¸åˆ°é™æ€èµ„æºã€‚

  # Vue å’Œ Typescriptçš„ä½¿ç”¨

  ## å‰æ

  scriptæ ‡ç­¾åŠ å…¥ : lang=â€œtsâ€

  ```js
  <script lang="ts">
     Â·Â·Â·
  </script>
  ```

  ## åˆ›å»ºç»„ä»¶

  ```js
  import { Component, Prop, Vue, Watch } from 'vue-property-decorator';
  
  @Component
  export default class Test extends Vue {
  
  }
  ```

  ## ç»„ä»¶çš„å¼•å…¥

  ```js
  import Mapmenu from '@/components/Mapmenu.vue'
  
  @Component({
   components: {
     Mapmenu
  }
  })
  ```

  ## dataå¯¹è±¡

  booleanæˆ–è€…stringç­‰ç®€å•ç±»å‹typescriptä¼šè‡ªåŠ¨è¯†åˆ«ï¼Œä¸éœ€è¦å‘ŠçŸ¥ç±»å‹,ä¸ç„¶è¿è¡Œçš„æ—¶å€™å®ƒè¿˜ç»™æˆ‘ä¸ªæŠ¥é”™â€¦â€¦

  ```js
  import { Component, Prop, Vue, Watch } from 'vue-property-decorator';
  
  export default class Map extends Vue {
   map: any = null
   dialog = false
   name = "MAGREN"
  }
  ```

  ## method æ–¹æ³•

  å¯ä¸ç”¨é€—å·éš”å¼€ï¼Œç›´æ¥å†™åœ¨export defaulté‡Œï¼Œéœ€è¦æ³¨æ˜è¿”å›ç±»å‹

  ```js
  <script lang="ts">
  import { Component,Vue,Prop,Emit } from 'vue-property-decorator';
  import markers from '@/config/markers.ts'
  
  @Component
  export default class Mapmenu extends Vue {
   
   show = true
   // methods
   //å­¦æ ¡ä»‹ç»
   toPageSchoolInfo(): void{
     this.$router.push({
       path:'/schoolinfo'
    })
  }
   
      â€¦â€¦â€¦â€¦â€¦â€¦
  }
  ```

  ## Propä»¥åŠEmit ç”¨äºçˆ¶å­ç»„ä»¶ä¼ å‚

  ### çˆ¶ç»„ä»¶

  :map = 'mapâ€™è¡¨ç¤ºå°†çˆ¶ç»„ä»¶çš„mapå‚æ•°ä¼ å…¥å­ç»„ä»¶ï¼Œå¹¶ä¸”å‘½åä¸ºmapã€‚
  @show-dialog=â€œhandleChildValueâ€ è¡¨ç¤ºå°†å­ç»„ä»¶ä¼ æ¥çš„å€¼åœ¨handleChildValueæ–¹æ³•ä¸­å¤„ç†ã€‚

  ```js
  <template>
  <Mapmenu :map='map' @show-dialog="handleChildValue"></Mapmenu>
  </template>
  
  <script lang="ts">
  // @ is an alias to /src
  import AMap from '@/config/amap.ts'
  import Mapmenu from '@/components/Mapmenu.vue'
  import { Component,Vue } from 'vue-property-decorator';
  
  @Component({
   components: {
     Mapmenu
  }
  })
  
  export default class Map extends Vue {
    dialog = false 
    â€¦â€¦
     
    private handleChildValue(val: boolean) {
         // val: å­ç»„ä»¶ä¼ è¿‡æ¥çš„å€¼
       this.dialog = val;
      }
  }
  ```

  ### å­ç»„ä»¶

  è°ƒç”¨çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„å‚æ•°ç›´æ¥ä½¿ç”¨this.xxx
  éœ€è¦å‘çˆ¶ç»„ä»¶ä¼ é€’å‚æ•°ç›´æ¥è°ƒç”¨@Emitæ³¨è§£é‡Œçš„æ–¹æ³•ã€‚

  ```js
  <script lang="ts">
  //å¼•å…¥Propå’ŒEmit
  import { Component,Vue,Prop,Emit } from 'vue-property-decorator'; 
  import markers from '@/config/markers.ts'
  
  @Component
  export default class Mapmenu extends Vue {
   
   show = true
  
   //æ¥æ”¶çˆ¶ç»„ä»¶ä¼ æ¥çš„å€¼
   @Prop()
   private map: any
  
   //å‘çˆ¶ç»„ä»¶ä¼ å€¼
   @Emit()
   private showDialog(){
     return this.show
  }
  }
  ```

  # é«˜å¾·åœ°å›¾åŠ è½½å’Œä½¿ç”¨

  ## é«˜å¾·åœ°å›¾åŠ è½½

  å°è£…åœ°å›¾ï¼Œå¹¶é€šè¿‡Promiseè¿›è¡Œä¸€ä¸ªå¼‚æ­¥åŠ è½½ï¼ŒTypeScriptåœ¨ç¼–è¯‘æ—¶å¯¹windowç±»å‹åšäº†åˆ¤æ–­,ä¸å…è®¸ç›´æ¥è°ƒç”¨window.xxï¼Œæ”¹æˆanyç±»å‹å³å¯ä½¿ç”¨ã€‚åŠ è½½å‰å…ˆåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ã€‚

  ```js
  export default function MapLoader(): Promise<void>{
   return new Promise((resolve, reject) => {
     const win: any = window  
     if (win.AMap) {
       resolve(win.AMap)
    } else {
       const url='é«˜å¾·åœ°å›¾api'
       const script: HTMLScriptElement = document.createElement('script')
       script.charset = 'utf-8'
       script.src = url
       script.onerror = reject
       document.head.appendChild(script)
    }
     win.onLoad = () => {
       resolve(win.AMap)
    }
  })
  }
  ```

  åœ¨éœ€è¦çš„åœ°æ–¹è°ƒç”¨

  ```js
  <template>
   <div id="map">
     <div id="container">
      
     </div>
   </div>
  </template>
  
  <script lang="ts">
  import AMap from '@/config/amap.ts'
  import { Component,Vue } from 'vue-property-decorator';
  
  export default class Map extends Vue {
   map: any = null
  
   //åˆå§‹åŒ–åœ°å›¾
   async initAMap(): Promise<void> {
    try {
     const res: any = await AMap();
     this.map = new res.Map("container", {  //è£…è½½åœ¨idä¸ºcontainerçš„div
       viewMode:'3D', // åœ°å›¾æ¨¡å¼,æ‰‹æœºä¸‹åªæœ‰2dæ•ˆæœ
       resizeEnable: true, //æ˜¯å¦ç›‘æ§åœ°å›¾å®¹å™¨å°ºå¯¸å˜åŒ–
       zoom: 17, //åˆå§‹åŒ–åœ°å›¾å±‚çº§ï¼Œ
       center: [113.172847,23.43399], //åˆå§‹åŒ–åœ°å›¾ä¸­å¿ƒç‚¹ï¼Œ
       pitch:40, // åœ°å›¾ä¿¯ä»°è§’åº¦ï¼Œæœ‰æ•ˆèŒƒå›´ 0 åº¦- 83 åº¦
       buildingAnimation:true, //3dåœ°å›¾æ˜¾ç¤ºåŠ¨ç”»
      });
      this.personOptions(this.map,true)
    }catch (err) {
       console.error(err);
    } 
  }
   
   mounted() {
      this.initAMap();
  }
  }
  </script>
  ```

  ## ç»™åœ°å›¾æ·»åŠ marker

  ```js
  const win: any = window
  const marker = new win.AMap.Marker({
           position: new win.AMap.LngLat(113.171688,23.433279),  //markerçš„åæ ‡ 
  })
  ```

  åœ¨markerä¸Šæ–¹æ·»åŠ æ–‡æœ¬:

  ```js
  marker.setLabel({ //labelé»˜è®¤è“æ¡†ç™½åº•å·¦ä¸Šè§’æ˜¾ç¤ºl
           offset: new win.AMap.Pixel(0, -3),  //è®¾ç½®æ–‡æœ¬æ ‡æ³¨åç§»é‡
           content:"å•†ä¸šè¡—", //è®¾ç½®æ–‡æœ¬æ ‡æ³¨å†…å®¹
           direction: 'top' //è®¾ç½®æ–‡æœ¬æ ‡æ³¨æ–¹ä½
  }); 
  ```

  ä¿®æ”¹æ ·å¼ï¼š
  æ­¤æ—¶cssæ ‡ç­¾ä¸­ä¸èƒ½æ‰“ scoped ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆï¼Œè¿™ä¸ªé—®é¢˜å…³ä¹cssçš„ä½œç”¨åŸŸ

  ```css
  .amap-marker-label{ 
   padding: 5px;
   border-radius: 3px;
   border-color: #54B7E7;
   border-width: 0px;
   color:#54B7E7;
  }
  ```

  æœ€åè°ƒç”¨addæ–¹æ³•æ·»åŠ ï¼š

  ```js
  this.map.add(marker)
  ```

